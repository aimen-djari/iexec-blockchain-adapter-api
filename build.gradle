plugins {
	id 'org.springframework.boot' version '2.4.3'
	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
	id 'java'
	id 'com.palantir.docker' version '0.26.0'
}

group = 'com.iexec.chain'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
	// iExec
	maven {
		url "https://nexus.iex.ec/repository/maven-public/"
	}
	maven {
		url "https://jitpack.io"
	}
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	compileOnly 'org.projectlombok:lombok'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'

	// iexec
	implementation "com.iexec.common:iexec-common:$iexecCommonVersion"
	//implementation files("../iexec-common/build/libs/iexec-common-${iexecCommonVersion}.jar")
}

test {
	useJUnitPlatform()
}

def jar = rootProject.name + '-' + version + ".jar"

docker {
	name 'docker.io/iexechub/' + rootProject.name + ':dev'
	dockerfile file('docker/Dockerfile-local')
	files('build/libs/' + jar)
	buildArgs([JAR_PATH: jar ])
}
tasks.docker.dependsOn tasks.build
